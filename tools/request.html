<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 调用示例</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        h1, h2 {
            color: #333;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        input, textarea, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .file-input-container {
            display: flex; /* 使用 flexbox 布局 */
            align-items: center; /* 垂直居中对齐 */
        }

        .file-input-container input[type="text"] {
            margin-right: 10px; /* 添加右边距以分隔两个输入框 */
            flex-grow: 1; /* 使文本框占据剩余空间 */
        }

        .file-input-container input[type="file"] {
            flex-shrink: 0; /* 防止文件输入框缩小 */
            width: auto; /* 使文件输入框宽度自适应 */
        }

        button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #218838;
        }

        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow: auto;
        }
    </style>
</head>
<body>
<h1>API 调用工具</h1>

<div class="container">
    <h2>GET 请求</h2>
    <input type="text" id="getUrl" placeholder="输入 GET 请求 URL">
    <button onclick="sendGetRequest()">发送 GET 请求</button>
    <pre id="getResponse"></pre>
</div>

<div class="container">
    <h2>POST 请求 (JSON)</h2>
    <input type="text" id="postJsonUrl" placeholder="输入 POST 请求 URL">
    <textarea id="jsonData" rows="4" placeholder='输入 JSON 数据，例如 {"key": "value"}'></textarea>
    <button onclick="sendPostJsonRequest()">发送 POST 请求</button>
    <pre id="postJsonResponse"></pre>
</div>

<div class="container">
    <h2>POST 请求 (Form Data + 上传 File)</h2>
    <input type="text" id="postFileUrl" placeholder="输入 POST 请求 URL">
    <textarea id="otherParams" rows="4" placeholder='输入其他参数，例如 key1=value1, key2=value2'></textarea>
    <div class="file-input-container">
        <input type="text" id="fileKey" placeholder="输入文件键（key）">
        <input type="file" id="fileInput">
    </div>
    <button onclick="sendPostFileRequest()">发送 POST 请求</button>
    <pre id="postFileResponse"></pre>
</div>

<script>
    function sendGetRequest() {
        const url = document.getElementById('getUrl').value;
        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络响应不是 OK');
                }
                const contentDisposition = response.headers.get('Content-Disposition');
                const contentType = response.headers.get('Content-Type');
                const isFileDownload = contentDisposition && contentDisposition.includes('attachment');

                if (isFileDownload) {
                    // 从 response.blob() 返回多个信息，确保能够访问 headers
                    return response.blob().then(blob => ({ blob, response }));
                } else if (contentType && contentType.includes('application/octet-stream')) {
                    // 如果 Content-Disposition 为空，但是 Content-Type 提示是二进制文件
                    return response.blob().then(blob => ({ blob, response }));
                } else {
                    return response.text();
                }
            })
            .then(data => {
                if (typeof data === 'string') {
                    // 普通文本内容
                    document.getElementById('getResponse').textContent = data;
                } else {
                    const { blob, response } = data;
                    // 处理文件下载
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    // 获取文件名
                    const contentDisposition = response.headers.get('Content-Disposition');
                    const fileNameMatch = contentDisposition ? contentDisposition.match(/filename="(.+)"/) : null;
                    const fileName = (fileNameMatch && fileNameMatch[1]) ? fileNameMatch[1] : 'downloaded_file';
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);
                }
            })
            .catch(error => {
                document.getElementById('getResponse').textContent = '错误: ' + error;
            });
    }

    function sendPostJsonRequest() {
        const url = document.getElementById('postJsonUrl').value;
        const jsonData = document.getElementById('jsonData').value;

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: jsonData
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络响应不是 OK');
                }
                const contentDisposition = response.headers.get('Content-Disposition');
                const contentType = response.headers.get('Content-Type');
                const isFileDownload = contentDisposition && contentDisposition.includes('attachment');

                if (isFileDownload) {
                    // 从 response.blob() 返回多个信息，确保能够访问 headers
                    return response.blob().then(blob => ({ blob, response }));
                } else if (contentType && contentType.includes('application/octet-stream')) {
                    // 如果 Content-Disposition 为空，但是 Content-Type 提示是二进制文件
                    return response.blob().then(blob => ({ blob, response }));
                } else {
                    return response.text();
                }
            })
            .then(data => {
                if (typeof data === 'string') {
                    // 普通文本内容
                    document.getElementById('postJsonResponse').textContent = data;
                } else {
                    const { blob, response } = data;
                    // 处理文件下载
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    // 获取文件名
                    const contentDisposition = response.headers.get('Content-Disposition');
                    const fileNameMatch = contentDisposition ? contentDisposition.match(/filename="(.+)"/) : null;
                    const fileName = (fileNameMatch && fileNameMatch[1]) ? fileNameMatch[1] : 'downloaded_file';
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);
                }
            })
            .catch(error => {
                document.getElementById('postJsonResponse').textContent = '错误: ' + error;
            });
    }

    function sendPostFileRequest() {
        const url = document.getElementById('postFileUrl').value;
        const fileKey = document.getElementById('fileKey').value;
        const otherParams = document.getElementById('otherParams').value.split(',').reduce((acc, param) => {
            const [key, value] = param.split('=');
            if (key && value) {
                acc[key.trim()] = value.trim();
            }
            return acc;
        }, {});

        const fileInput = document.getElementById('fileInput');
        const formData = new FormData();

        if (fileInput.files.length > 0 && fileKey) {
            formData.append(fileKey, fileInput.files[0]);
            for (const [key, value] of Object.entries(otherParams)) {
                formData.append(key, value);
            }

            fetch(url, {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('postFileResponse').textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById('postFileResponse').textContent = '错误: ' + error;
                });
        } else {
            document.getElementById('postFileResponse').textContent = '请先选择一个文件并输入文件键。';
        }
    }
</script>
</body>
</html>
